- name: Create a Persistent Volume for Prometheus
  kubernetes.core.k8s:
    state: present
    definition:
      apiVersion: v1
      kind: PersistentVolume
      metadata:
        name: prometheus
        labels:
          app.kubernetes.io/managed-by: Ansible
          app.kubernetes.io/part-of: prometheus
      spec:
        capacity:
          storage: "{{ prometheus_capacity_storage }}"
        volumeMode: Filesystem
        accessModes:
          - ReadWriteOnce
        persistentVolumeReclaimPolicy: Retain
        storageClassName: '{{ prometheus_storage_class }}'
        local:
          path: '{{ prometheus_storage_local_path }}'
        nodeAffinity:
          required:
            nodeSelectorTerms:
              - matchExpressions:
                  - key: prometheus
                    operator: In
                    values:
                      - "true"

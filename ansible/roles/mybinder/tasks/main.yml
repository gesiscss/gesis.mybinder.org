- name: Add hub.jupyter.org/node-purpose label
  ansible.builtin.shell: |
    {% for host in hostvars %}
    {% if host != 'localhost' %}
    {% if host in groups['binderhub'] %}
    kubectl label nodes {{ host }} hub.jupyter.org/node-purpose=core
    {% else %}
    kubectl label nodes {{ host }} hub.jupyter.org/node-purpose-
    {% endif %}
    {% endif %}
    {% endfor %}
  changed_when: false
- name: Add labels from inventory
  ansible.builtin.shell: |
    {% for host in hostvars %}
    {% if host != 'localhost' %}
    {% for group, host_list in groups.items() %}
    {% if host in host_list %}
    kubectl label nodes {{ host }} {{ group }}=true
    {% else %}
    kubectl label nodes {{ host }} {{ group }}-
    {% endif %}
    {% endfor %}
    {% endif %}
    {% endfor %}
  changed_when: false
- name: Configure orc2-fix-jupyterhub-bot
  become: true
  ansible.builtin.import_tasks:
    file: orc2-fix-jupyterhub-bot.yml
- name: Configure orc2-fix-dind-bot
  become: true
  ansible.builtin.import_tasks:
    file: orc2-fix-dind-bot.yml
- name: Configure kill-succeeded-pods
  ansible.builtin.import_tasks:
    file: kill-succeeded-pods.yml
- name: Configure kill-after-timeout-pods
  ansible.builtin.import_tasks:
    file: kill-after-timeout-pods.yml

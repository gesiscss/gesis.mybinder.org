- name: Create a Persistent Volume for Grafana
  kubernetes.core.k8s:
    state: present
    definition:
      apiVersion: v1
      kind: PersistentVolume
      metadata:
        name: grafana
        labels:
          app.kubernetes.io/managed-by: Ansible
          app.kubernetes.io/part-of: grafana
      spec:
        capacity:
          storage: "{{ grafana_capacity_storage }}"
        volumeMode: Filesystem
        accessModes:
          - ReadWriteOnce
        persistentVolumeReclaimPolicy: Retain
        storageClassName: '{{ grafana_storage_class }}'
        local:
          path: '{{ grafana_storage_local_path }}'
        nodeAffinity:
          required:
            nodeSelectorTerms:
              - matchExpressions:
                  - key: grafana
                    operator: In
                    values:
                      - "true"
